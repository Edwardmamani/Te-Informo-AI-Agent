# Reglas Generales de Arquitectura - Responsabilidades de Carpetas

Estas reglas definen las responsabilidades y restricciones para cada carpeta en `agente-service/src`. Seguir estas reglas asegura mantener la separaciÃ³n de responsabilidades y la arquitectura del proyecto.

## Reglas por Carpeta

### ğŸ“ `agents/`
- **SOLO** debe contener definiciones de agentes de IA usando CrewAI
- **DEBE** usar funciones factory (ej: `create_*_agent()`) para crear instancias
- **DEBE** definir roles, objetivos y backstories para cada agente
- **DEBE** obtener el LLM desde `src.config.settings.get_llm()`
- **NO DEBE** contener lÃ³gica de negocio o procesamiento de requests
- **NO DEBE** llamar directamente a crews o tareas

### ğŸ“ `tasks/`
- **SOLO** debe contener definiciones de `Task` de CrewAI
- **DEBE** usar funciones factory (ej: `create_*_task()`) para crear instancias
- **DEBE** asignar agentes especÃ­ficos a cada tarea
- **DEBE** definir descripciones detalladas y outputs esperados
- **PUEDE** importar agentes desde `src.agents` para asignarlos
- **NO DEBE** ejecutar tareas directamente ni contener lÃ³gica de procesamiento

### ğŸ“ `crews/`
- **SOLO** debe contener definiciones de `Crew` de CrewAI
- **DEBE** usar funciones factory (ej: `create_*_crew()`) para crear instancias
- **DEBE** combinar agentes y tareas para crear workflows
- **PUEDE** importar agentes desde `src.agents` y tareas desde `src.tasks`
- **NO DEBE** ejecutar crews directamente (eso es responsabilidad de controllers)
- **NO DEBE** contener lÃ³gica de validaciÃ³n o manejo de errores

### ğŸ“ `controllers/`
- **DEBE** contener toda la lÃ³gica de negocio y procesamiento de solicitudes
- **DEBE** validar datos de entrada antes de procesar
- **DEBE** invocar crews desde `src.crews` para ejecutar workflows
- **DEBE** manejar errores y excepciones
- **DEBE** retornar tuplas `(respuesta_dict, cÃ³digo_estado_HTTP)`
- **PUEDE** formatear y transformar datos antes de retornar
- **NO DEBE** definir rutas HTTP (eso es responsabilidad de routers)
- **NO DEBE** crear directamente agentes, tareas o crews (debe usar funciones factory)

### ğŸ“ `routers/`
- **SOLO** debe contener definiciones de rutas HTTP/API
- **DEBE** usar blueprints de Flask para agrupar rutas relacionadas
- **DEBE** extraer datos del request (JSON body, query params, etc.)
- **DEBE** llamar a funciones de controllers para procesar solicitudes
- **DEBE** retornar respuestas JSON al cliente
- **NO DEBE** contener lÃ³gica de negocio (debe delegar a controllers)
- **NO DEBE** ejecutar crews, agentes o tareas directamente

### ğŸ“ `config/`
- **SOLO** debe contener configuraciones del sistema
- **DEBE** centralizar todas las configuraciones (LLM, servidor, etc.)
- **DEBE** proporcionar funciones para obtener instancias configuradas
- **DEBE** usar variables de entorno cuando sea apropiado
- **PUEDE** importar utilidades desde `src.utils` para cargar configuraciones
- **NO DEBE** contener lÃ³gica de negocio o procesamiento
- **NO DEBE** ejecutar crews, agentes o tareas

### ğŸ“ `utils/`
- **SOLO** debe contener funciones utilitarias compartidas
- **DEBE** ser independiente de otras capas (sin dependencias circulares)
- **PUEDE** contener helpers para carga de variables de entorno
- **PUEDE** proporcionar funciones para acceso a API keys
- **NO DEBE** contener lÃ³gica de negocio especÃ­fica
- **NO DEBE** depender de agents, tasks, crews o controllers

### ğŸ“ `services/`
- **DEBE** contener servicios de lÃ³gica de negocio compleja cuando sea necesario
- **PUEDE** proporcionar abstracciones sobre APIs externas
- **PUEDE** manejar operaciones que requieren mÃºltiples pasos
- **PUEDE** ser importado por controllers cuando se necesite lÃ³gica reutilizable
- **NO DEBE** definir rutas HTTP ni agentes directamente
- **NO DEBE** ejecutar crews directamente (debe ser invocado por controllers)

### ğŸ“ `test/`
- **DEBE** contener todos los archivos de prueba
- **PUEDE** incluir tests unitarios, de integraciÃ³n y pruebas manuales
- **PUEDE** contener ejemplos de uso de la API
- **NO DEBE** contener cÃ³digo de producciÃ³n

## Reglas de Flujo de Datos

### Flujo Correcto de Dependencias
```
Cliente â†’ routers/ â†’ controllers/ â†’ crews/ â†’ agents/ + tasks/
                                                â†“
                                           config/ + utils/
```

### Reglas de ImportaciÃ³n
- `routers/` puede importar desde: `controllers/`
- `controllers/` puede importar desde: `crews/`, `config/`, `utils/`, `services/`
- `crews/` puede importar desde: `agents/`, `tasks/`, `config/`, `utils/`
- `agents/` puede importar desde: `config/`, `utils/`
- `tasks/` puede importar desde: `agents/`, `config/`, `utils/`
- `config/` puede importar desde: `utils/`
- `utils/` NO debe importar desde otras capas (excepto librerÃ­as externas)
- `services/` puede importar desde: `config/`, `utils/`

### Reglas de EjecuciÃ³n
- **NO** ejecutar crews directamente desde routers
- **NO** ejecutar crews directamente desde agents o tasks
- **NO** crear agentes o tasks directamente desde controllers (usar factory functions)
- **SÃ** ejecutar crews desde controllers
- **SÃ** usar factory functions para crear instancias

## Patrones de DiseÃ±o Requeridos

### Factory Pattern
- **AGENTES**: Usar funciones `create_*_agent()` en `agents/`
- **TAREAS**: Usar funciones `create_*_task()` en `tasks/`
- **CREWS**: Usar funciones `create_*_crew()` en `crews/`

### SeparaciÃ³n de Responsabilidades
- Cada carpeta tiene un propÃ³sito Ãºnico y claro
- No mezclar responsabilidades entre carpetas
- Mantener dependencias unidireccionales

### Manejo de Errores
- Los controllers deben manejar errores y retornar cÃ³digos HTTP apropiados
- Los routers deben retornar respuestas JSON formateadas
- Los crews, agents y tasks NO deben manejar errores HTTP

## Convenciones de Nomenclatura

- **Agentes**: `create_{nombre}_agent()` (ej: `create_investigador_agent()`)
- **Tareas**: `create_{nombre}_task()` (ej: `create_query_task()`)
- **Crews**: `create_{nombre}_crew()` (ej: `create_query_crew()`)
- **Controllers**: `handle_{acciÃ³n}()` (ej: `handle_query()`)
- **Rutas**: Usar nombres descriptivos en snake_case para funciones de endpoint

## Notas Importantes

- Mantener la arquitectura limpia y modular
- Seguir el flujo de datos establecido
- Usar factory functions para todas las instancias
- No crear dependencias circulares
- Mantener las responsabilidades claramente separadas
